<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <script>
    document.write("<h1>XX电商 · 运营后台 · 订单录入与销售看板</h1>");
  document.write("<p>欢迎使用内部工具，实时查看订单与销售情况。</p>");

  // ===================== 全局优惠 + 加价温馨提示 =====================
  document.write(`
  <div style="padding:12px; background:#eef9ff; border-left:5px solid #3aa0e6; margin:10px 0; font-size:15px;">
    <strong>💡 温馨提示：本店当前可享受的优惠与加价政策如下：</strong>
    <ul style="margin:8px 0 0 20px; line-height:1.6;">
      <li>🎉 VIP 客户享受 <strong>9 折优惠</strong></li>
      <li>⚡ 加急发货价格会 <strong>×1.1</strong></li>
      <li>⏰ 每小时前 10 分钟再享 <strong>8.5 折</strong></li>
    </ul>
  </div>
   `);
   var nowForBanner = new Date();            // Date()：创建一个时间对象
  var minuteForBanner = nowForBanner.getMinutes(); // getMinutes()：获取当前分钟（0–59）

  if (minuteForBanner >= 0 && minuteForBanner <= 9) {
    document.write(`
      <div style="padding:12px; background:#fffbe6; border-left:5px solid #f4d06f; margin:10px 0; font-size:15px;">
        ⏳ 当前为前 10 分钟！本单可额外享受 <strong>8.5 折</strong> 时段优惠！
      </div>
    `);
  } else {
    document.write(`
      <div style="padding:12px; background:#f5f5f5; border-left:5px solid #ccc; margin:10px 0; font-size:15px;">
        🕒 小贴士：每个整点前 10 分钟享受 8.5 折优惠，请留意下单时间～
      </div>
    `);
  }
    
    </script>
<!--开头                                       -->
<div class="box">
  <h2>当前系统时间</h2>
  <!-- 此区域的文字由 JavaScript 动态更新 -->
  <div id="clock" class="clock"></div>
</div>
<div class="box">
  <h2>新建订单</h2>

  <!-- onsubmit="return validateForm()"：提交表单前调用 JS 做校验 -->
  <form onsubmit="return validateForm();">
    <p>
      <label>客户名称：</label>
      <input type="text" id="customerName">
    </p>
    <p>
      <label>商品单价（¥）：</label>
      <input type="text" id="priceInput">
    </p>
    <p>
      <label>数量（件）：</label>
      <input type="text" id="qtyInput">
    </p>
    <p>
      <label>客户类型：</label>
      <select id="customerType">
        <option value="normal">普通客户</option>
        <option value="vip">VIP 客户</option>
      </select>
    </p>
    <p>
      <label>加急发货：</label>
      <input type="checkbox" id="urgentFlag"> 是
    </p>
    <p><button type="submit">添加订单</button></p>
  </form>

  <div id="orderResult"></div>
</div>

<!-- ===================== 销售看板 ===================== -->
<div class="box">
  <h2>销售看板</h2>
  <div id="dashboard"></div>
  <div id="orderTable"></div>
</div>

<script>
function padZero(n) {
    return n < 10 ? "0" + n : n;
  }

  /**
   * updateClock()
   * 功能：获取当前时间 → 格式化 → 写入页面
   * 技术点：
   *   - Date()                  获取当前时间
   *   - getElementById()        获取页面指定 id 的元素
   *   - innerHTML               用于设置元素的 HTML 内容
   */
  function updateClock() {
    var now = new Date();
    var y = now.getFullYear();
    var m = now.getMonth() + 1;
    var d = now.getDate();
    var hh = now.getHours();
    var mm = now.getMinutes();
    var ss = now.getSeconds();

    var weekNames = ["日", "一", "二", "三", "四", "五", "六"];
    var w = weekNames[now.getDay()];

    var timeStr =
      y + "年" + padZero(m) + "月" + padZero(d) +
      "日 星期" + w + " " +
      padZero(hh) + ":" + padZero(mm) + ":" + padZero(ss);

    // document.getElementById("clock")
    // 功能：返回页面中 id="clock" 的那个元素
    document.getElementById("clock").innerHTML = timeStr;
  }

  updateClock();               // 页面刚加载时调用一次
 setInterval(updateClock, 1000); // setInterval：每 1000ms 调用一次 → 实现走动的时钟
//=============
 function validateForm() {
    /**
     * document.getElementById("xxx").value
     * 说明：从页面中获取 id="xxx" 的输入框内容
     */
    var nameStr = document.getElementById("customerName").value;
    var priceStr = document.getElementById("priceInput").value;
    var qtyStr = document.getElementById("qtyInput").value;
    var typeStr = document.getElementById("customerType").value;
    var urgentChecked = document.getElementById("urgentFlag").checked;

    var valid = true;

    // 客户名称校验
    if (nameStr == null || nameStr.trim() === "") {
      alert("客户名称不能为空！");
      valid = false;
    }

    // parseFloat()：把字符串转成浮点型数字
    var price = parseFloat(priceStr);
    if (isNaN(price) || price <= 0) {
      alert("商品单价必须是大于 0 的数字！");
      valid = false;
    }

    // parseInt()：把字符串转成整数
    var qty = parseInt(qtyStr, 10);
    if (isNaN(qty) || qty <= 0) {
      alert("数量必须是大于 0 的整数！");
      valid = false;
    }

    if (!valid) {
      document.getElementById("orderResult").innerHTML =
        "<p>订单录入失败，请检查输入。</p>";
      return false;
    }

    processOrder(nameStr.trim(), price, qty, typeStr === "vip", urgentChecked);
    return false;
  }

  function processOrder(customerName, price, quantity, isVip, isUrgent) {
    var baseTotal = price * quantity;

    var afterVip = isVip ? baseTotal * 0.9 : baseTotal;

    var afterUrgent = isUrgent ? afterVip * 1.1 : afterVip;

    var now = new Date();
    var minute = now.getMinutes();

    var hitTimeDiscount = false;
    var finalTotal = afterUrgent;

    if (minute >= 0 && minute <= 9) {
      finalTotal *= 0.85;
      hitTimeDiscount = true;
    }
    if(!isVip && finalTotal > 500)
    {
        finalTotal = finalTotal * 0.95;
    }
    var isImportant = isVip && finalTotal > 1000;

    var tipsHtml = "<ul>";
    tipsHtml += isVip ? "<li>VIP 9折已应用</li>" : "<li>普通客户无 VIP 优惠</li>";
    tipsHtml += isUrgent ? "<li>加急 ×1.1 已应用</li>" : "<li>未加急</li>";
    tipsHtml += hitTimeDiscount ? "<li>命中前十分钟 ×0.85</li>" : "<li>无时段折扣</li>";
    tipsHtml += "</ul>";

    document.getElementById("orderResult").innerHTML =
      "<h3>订单录入成功：</h3>" +
      "<p>客户名称：" + customerName + "</p>" +
      "<p>基础金额：¥" + baseTotal.toFixed(2) + "</p>" +
      "<p>VIP 后：¥" + afterVip.toFixed(2) + "</p>" +
      "<p>加急后：¥" + afterUrgent.toFixed(2) + "</p>" +
      "<p>最终金额：¥" + finalTotal.toFixed(2) + "</p>" +
      "<p>订单类型：" + (isImportant ? "大额 VIP" : "普通订单") + "</p>" +
      "<div style='background:#eef; padding:8px;'>优惠详情：" + tipsHtml + "</div>";

    orders.push({
      name: customerName,
      price: price,
      qty: quantity,
      baseTotal: baseTotal,
      finalTotal: finalTotal,
      isVip: isVip,
      isUrgent: isUrgent,
      hitTimeDiscount: hitTimeDiscount
    });
</script>




</body>
</html>